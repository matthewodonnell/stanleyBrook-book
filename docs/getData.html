<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Get data | The West Brook Story</title>
  <meta name="description" content="This book describes accessing, cleaning, and analyzing data from the West Brook Study in western MA, USA" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Get data | The West Brook Story" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/westBrook.jpg" />
  <meta property="og:description" content="This book describes accessing, cleaning, and analyzing data from the West Brook Study in western MA, USA" />
  <meta name="github-repo" content="bletcher/westBrook-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Get data | The West Brook Story" />
  
  <meta name="twitter:description" content="This book describes accessing, cleaning, and analyzing data from the West Brook Study in western MA, USA" />
  <meta name="twitter:image" content="/images/westBrook.jpg" />

<meta name="author" content="Ben Letcher" />


<meta name="date" content="2022-05-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="index.html"/>
<link rel="next" href="models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-west-brook"><i class="fa fa-check"></i><b>1.1</b> The West Brook</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getData.html"><a href="getData.html"><i class="fa fa-check"></i><b>2</b> Get data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getData.html"><a href="getData.html#getEnvData"><i class="fa fa-check"></i><b>2.1</b> Get environmental data</a></li>
<li class="chapter" data-level="2.2" data-path="getData.html"><a href="getData.html#dataElectro"><i class="fa fa-check"></i><b>2.2</b> Electrofishing data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getData.html"><a href="getData.html#get-data"><i class="fa fa-check"></i><b>2.2.1</b> Get data</a></li>
<li class="chapter" data-level="2.2.2" data-path="getData.html"><a href="getData.html#wrangle-data"><i class="fa fa-check"></i><b>2.2.2</b> Wrangle data</a></li>
<li class="chapter" data-level="2.2.3" data-path="getData.html"><a href="getData.html#explore-data"><i class="fa fa-check"></i><b>2.2.3</b> Explore data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getData.html"><a href="getData.html#dataCMR"><i class="fa fa-check"></i><b>2.3</b> Capture-recapture data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="getData.html"><a href="getData.html#temporary-home-for-updated-functions"><i class="fa fa-check"></i><b>2.3.1</b> Temporary home for updated functions</a></li>
<li class="chapter" data-level="2.3.2" data-path="getData.html"><a href="getData.html#get-data-1"><i class="fa fa-check"></i><b>2.3.2</b> Get data</a></li>
<li class="chapter" data-level="2.3.3" data-path="getData.html"><a href="getData.html#make-encounter-history-files"><i class="fa fa-check"></i><b>2.3.3</b> Make encounter history files</a></li>
<li class="chapter" data-level="2.3.4" data-path="getData.html"><a href="getData.html#wrangle-data-1"><i class="fa fa-check"></i><b>2.3.4</b> Wrangle data</a></li>
<li class="chapter" data-level="2.3.5" data-path="getData.html"><a href="getData.html#explore-data-1"><i class="fa fa-check"></i><b>2.3.5</b> Explore data</a></li>
<li class="chapter" data-level="2.3.6" data-path="getData.html"><a href="getData.html#cmr-metadata"><i class="fa fa-check"></i><b>2.3.6</b> CMR metadata</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="getData.html"><a href="getData.html#dataWanding"><i class="fa fa-check"></i><b>2.4</b> Wanding data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="getData.html"><a href="getData.html#get-data-2"><i class="fa fa-check"></i><b>2.4.1</b> Get data</a></li>
<li class="chapter" data-level="2.4.2" data-path="getData.html"><a href="getData.html#wrangle-data-2"><i class="fa fa-check"></i><b>2.4.2</b> Wrangle data</a></li>
<li class="chapter" data-level="2.4.3" data-path="getData.html"><a href="getData.html#explore-data-2"><i class="fa fa-check"></i><b>2.4.3</b> Explore data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="getData.html"><a href="getData.html#dataAntenna"><i class="fa fa-check"></i><b>2.5</b> Antenna data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="getData.html"><a href="getData.html#get-data-3"><i class="fa fa-check"></i><b>2.5.1</b> Get data</a></li>
<li class="chapter" data-level="2.5.2" data-path="getData.html"><a href="getData.html#wrangle-data-3"><i class="fa fa-check"></i><b>2.5.2</b> Wrangle data</a></li>
<li class="chapter" data-level="2.5.3" data-path="getData.html"><a href="getData.html#explore-data-3"><i class="fa fa-check"></i><b>2.5.3</b> Explore data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="models.html"><a href="models.html"><i class="fa fa-check"></i><b>3</b> Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="models.html"><a href="models.html#modelYOY"><i class="fa fa-check"></i><b>3.1</b> Young-of-year size model</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="models.html"><a href="models.html#raw-data-for-yoy-model"><i class="fa fa-check"></i><b>3.1.1</b> Raw data for YOY model</a></li>
<li class="chapter" data-level="3.1.2" data-path="models.html"><a href="models.html#get-environmental-data"><i class="fa fa-check"></i><b>3.1.2</b> Get environmental data</a></li>
<li class="chapter" data-level="3.1.3" data-path="models.html"><a href="models.html#get-first-observations"><i class="fa fa-check"></i><b>3.1.3</b> Get first observations</a></li>
<li class="chapter" data-level="3.1.4" data-path="models.html"><a href="models.html#counts-of-captured-fish"><i class="fa fa-check"></i><b>3.1.4</b> Counts of captured fish</a></li>
<li class="chapter" data-level="3.1.5" data-path="models.html"><a href="models.html#raw-data-plots"><i class="fa fa-check"></i><b>3.1.5</b> Raw data plots</a></li>
<li class="chapter" data-level="3.1.6" data-path="models.html"><a href="models.html#models-based-on-yearly-means"><i class="fa fa-check"></i><b>3.1.6</b> Models based on yearly means</a></li>
<li class="chapter" data-level="3.1.7" data-path="models.html"><a href="models.html#models-with-extreme-flow-events-droughts"><i class="fa fa-check"></i><b>3.1.7</b> Models with extreme flow events (droughts)</a></li>
<li class="chapter" data-level="3.1.8" data-path="models.html"><a href="models.html#models-based-on-individual-observations"><i class="fa fa-check"></i><b>3.1.8</b> Models based on individual observations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="models.html"><a href="models.html#modelFlow"><i class="fa fa-check"></i><b>3.2</b> Flow model</a></li>
<li class="chapter" data-level="3.3" data-path="models.html"><a href="models.html#modelCMR_Flow"><i class="fa fa-check"></i><b>3.3</b> Flow effects on survival (phi) models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="models.html"><a href="models.html#model-phi_p"><i class="fa fa-check"></i><b>3.3.1</b> Model phi_p</a></li>
<li class="chapter" data-level="3.3.2" data-path="models.html"><a href="models.html#model-phit_pt"><i class="fa fa-check"></i><b>3.3.2</b> Model phiT_pT</a></li>
<li class="chapter" data-level="3.3.3" data-path="models.html"><a href="models.html#model-phit_pt_isyoy"><i class="fa fa-check"></i><b>3.3.3</b> Model phiT_pT_isYOY</a></li>
<li class="chapter" data-level="3.3.4" data-path="models.html"><a href="models.html#model-phit_pt_cohort"><i class="fa fa-check"></i><b>3.3.4</b> Model phiT_pT_cohort</a></li>
<li class="chapter" data-level="3.3.5" data-path="models.html"><a href="models.html#model-phit_pt_cohort_flow"><i class="fa fa-check"></i><b>3.3.5</b> Model phiT_pT_cohort_flow</a></li>
<li class="chapter" data-level="3.3.6" data-path="models.html"><a href="models.html#model-phit_pt_cohort_flowcohort"><i class="fa fa-check"></i><b>3.3.6</b> Model phiT_pT_cohort_flowCohort</a></li>
<li class="chapter" data-level="3.3.7" data-path="models.html"><a href="models.html#model-phit_pt_cohort_flowcohorthier"><i class="fa fa-check"></i><b>3.3.7</b> Model phiT_pT_cohort_flowCohortHier</a></li>
<li class="chapter" data-level="3.3.8" data-path="models.html"><a href="models.html#compare-models"><i class="fa fa-check"></i><b>3.3.8</b> Compare models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>4</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The West Brook Story</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getData" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Get data<a href="getData.html#getData" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The server hosting the data is named osensei and is at UMass (osensei.cns.umass.edu). It can be accessed using functions in the ‘getWBData’ package. Use
<code>devtools::install_github('Conte-Ecology/westBrookData/getWBData')</code> to install. Most of the functions will run reconnect() to connect to the server with your username and password. Run <code>reconnect()</code> from the console to connect if necessary. Use <code>conDplyr</code> to see the list of available tables on the server. Details about the ‘getWBData’ package are
<a href="https://github.com/Conte-Ecology/westBrookData/blob/master/getWBData/vignettes/getWBDataTutorial.pdf">here</a>.</p>
<p>We have two types of databases: Environmental and fish</p>
<p>The environmental database contains daily mean temperature and flow data. Flow data are from a flow extension model and are not tributary-specific. Temperature data are from tributary-specific loggers.</p>
<p>There are four main fish databases we want to create:<br />
1. <strong>cdWB_electro0</strong> West Brook electrofishing data, 3 species (brook trout, brown trout and Atlantic salmon), tagged and untagged fish<br />
2. <strong>cdWB_CMR0</strong> West Brook electrofishing data formatted for Capture-Mark-Recapture analysis for tagged individuals<br />
3. <strong>cdWB_wanding0</strong> West Brook wanding (portable antenna) data, all tagged salmonids<br />
4. <strong>cdWB_antenna0</strong> West Brook stationary antenna data, all tagged salmonids</p>
<p>The “0” at the end of these file names indicates that they are the initial files that will be wrangled in the next step (next chapter). “cd” stands for “core data”.</p>
<p>The <code>getNew_...</code> variables determine whether the data are retrieved from the server. Change to ‘TRUE’ to get a new data frame, e.g. when there are new data on the server.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="getData.html#cb1-1" aria-hidden="true" tabindex="-1"></a>getNew_envDataWB <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-2"><a href="getData.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="getData.html#cb1-3" aria-hidden="true" tabindex="-1"></a>getNew_cdWB_electro0 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-4"><a href="getData.html#cb1-4" aria-hidden="true" tabindex="-1"></a>getNew_cdWB_CMR0 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-5"><a href="getData.html#cb1-5" aria-hidden="true" tabindex="-1"></a>getNew_cdWB_wanding0 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-6"><a href="getData.html#cb1-6" aria-hidden="true" tabindex="-1"></a>getNew_cdWB_antenna0 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>

<div id="getEnvData" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Get environmental data<a href="getData.html#getEnvData" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="getData.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="getData.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(getNew_envDataWB) {</span>
<span id="cb3-2"><a href="getData.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-3"><a href="getData.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconnect</span>()</span>
<span id="cb3-4"><a href="getData.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  envDataWB <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conDplyr, <span class="st">&quot;data_daily_temperature&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="getData.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>(<span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="getData.html#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">tbl</span>(conDplyr, <span class="st">&quot;data_flow_extension&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="getData.html#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>(<span class="at">n =</span> <span class="cn">Inf</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;river&quot;</span>, <span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="getData.html#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="getData.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">temperature =</span> daily_mean_temp, <span class="at">flow =</span> qPredicted) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="getData.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dateDate =</span> <span class="fu">as_date</span>(date),</span>
<span id="cb3-11"><a href="getData.html#cb3-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">yday =</span> <span class="fu">yday</span>(dateDate))</span>
<span id="cb3-12"><a href="getData.html#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="getData.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(envDataWB, <span class="at">file =</span> <span class="st">&#39;./data/envDataWB.RData&#39;</span>)</span>
<span id="cb3-14"><a href="getData.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="getData.html#cb3-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-16"><a href="getData.html#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/envDataWB.RData&#39;</span>)</span>
<span id="cb3-17"><a href="getData.html#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="getData.html#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(envDataWB)</span></code></pre></div>
<pre><code>## tibble [32,189 × 7] (S3: tbl_df/tbl/data.frame)
##  $ river         : chr [1:32189] &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; ...
##  $ date          : POSIXct[1:32189], format: &quot;1997-05-14&quot; &quot;1997-05-15&quot; &quot;1997-05-16&quot; &quot;1997-05-17&quot; ...
##  $ temperature   : num [1:32189] 11.57 10.4 10.55 8.84 9.09 ...
##  $ daily_max_temp: num [1:32189] 11.6 12.3 11.9 10.2 11.6 ...
##  $ daily_min_temp: num [1:32189] 11.57 8.96 9.73 7.74 7.45 ...
##  $ flow          : num [1:32189] NA NA NA NA NA NA NA NA NA NA ...
##  $ dateDate      : Date[1:32189], format: &quot;1997-05-14&quot; &quot;1997-05-15&quot; &quot;1997-05-16&quot; &quot;1997-05-17&quot; ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="getData.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(envDataWB, <span class="fu">aes</span>(date, flow)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="getData.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-3"><a href="getData.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river)</span></code></pre></div>
<p><img src="westBrook-book_files/figure-html/envData-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="getData.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(envDataWB, <span class="fu">aes</span>(date, temperature)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="getData.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="getData.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river)</span></code></pre></div>
<p><img src="westBrook-book_files/figure-html/envData-2.png" width="672" /></p>
<p>need to add getting environmental data here</p>

</div>
<div id="dataElectro" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Electrofishing data<a href="getData.html#dataElectro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section retrieves electrofishing data, including both tagged and untagged fish. Fish were untagged if they were too small (&lt; 60 mm, 2 g wet weight) or were captured outside of the core study area (tributaries and 47 sections of the mainstem West Brook).</p>
<div id="get-data" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Get data<a href="getData.html#get-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="getData.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default values for createCoreData()</span></span>
<span id="cb7-2"><a href="getData.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function (sampleType = &quot;electrofishing&quot;, baseColumns = T, </span></span>
<span id="cb7-3"><a href="getData.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    columnsToAdd = NULL, includeUntagged = F, whichDrainage = &quot;west&quot;) </span></span>
<span id="cb7-4"><a href="getData.html#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="getData.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(getNew_cdWB_electro0) {</span>
<span id="cb7-6"><a href="getData.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  cdWB_electro0 <span class="ot">&lt;-</span> <span class="fu">createCoreData</span>(</span>
<span id="cb7-7"><a href="getData.html#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sampleType =</span> <span class="st">&quot;electrofishing&quot;</span>,  <span class="co">#&quot;stationaryAntenna&quot;,&quot;portableAntenna&quot;</span></span>
<span id="cb7-8"><a href="getData.html#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">columnsToAdd =</span> <span class="fu">c</span>(<span class="st">&quot;sampleNumber&quot;</span>,</span>
<span id="cb7-9"><a href="getData.html#cb7-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;river&quot;</span>,</span>
<span id="cb7-10"><a href="getData.html#cb7-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;survey&quot;</span>,</span>
<span id="cb7-11"><a href="getData.html#cb7-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;pass&quot;</span>,</span>
<span id="cb7-12"><a href="getData.html#cb7-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;observedLength&quot;</span>,</span>
<span id="cb7-13"><a href="getData.html#cb7-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;observedWeight&quot;</span>,</span>
<span id="cb7-14"><a href="getData.html#cb7-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;comments&quot;</span>),</span>
<span id="cb7-15"><a href="getData.html#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">includeUntagged =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-16"><a href="getData.html#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">whichDrainage =</span> <span class="st">&quot;west&quot;</span></span>
<span id="cb7-17"><a href="getData.html#cb7-17" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="getData.html#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addTagProperties</span>(</span>
<span id="cb7-19"><a href="getData.html#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">columnsToAdd =</span> <span class="fu">c</span>(<span class="st">&quot;cohort&quot;</span>,</span>
<span id="cb7-20"><a href="getData.html#cb7-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;species&quot;</span>,</span>
<span id="cb7-21"><a href="getData.html#cb7-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;dateEmigrated&quot;</span>,</span>
<span id="cb7-22"><a href="getData.html#cb7-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb7-23"><a href="getData.html#cb7-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;species&quot;</span></span>
<span id="cb7-24"><a href="getData.html#cb7-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-25"><a href="getData.html#cb7-25" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="getData.html#cb7-26" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;bkt&quot;</span>,<span class="st">&quot;bnt&quot;</span>,<span class="st">&quot;ats&quot;</span>),</span>
<span id="cb7-27"><a href="getData.html#cb7-27" aria-hidden="true" tabindex="-1"></a>                    area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;trib&quot;</span>,<span class="st">&quot;inside&quot;</span>,<span class="st">&quot;below&quot;</span>,<span class="st">&quot;above&quot;</span>),</span>
<span id="cb7-28"><a href="getData.html#cb7-28" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">!</span><span class="fu">is.na</span>(sampleNumber)) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="getData.html#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addSampleProperties</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="getData.html#cb7-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addEnvironmental</span>()</span>
<span id="cb7-31"><a href="getData.html#cb7-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-32"><a href="getData.html#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(cdWB_electro0, <span class="at">file =</span> <span class="st">&#39;./data/cdWB_electro0.RData&#39;</span>)</span>
<span id="cb7-33"><a href="getData.html#cb7-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-34"><a href="getData.html#cb7-34" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-35"><a href="getData.html#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/cdWB_electro0.RData&#39;</span>)</span>
<span id="cb7-36"><a href="getData.html#cb7-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-37"><a href="getData.html#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cdWB_electro0)</span></code></pre></div>
<pre><code>## tibble [91,103 × 22] (S3: tbl_df/tbl/data.frame)
##  $ tag              : chr [1:91103] &quot;00088cbed0&quot; &quot;00088cbed3&quot; &quot;00088cbed4&quot; &quot;00088cbed4&quot; ...
##  $ detectionDate    : POSIXct[1:91103], format: &quot;2013-03-25 00:00:00&quot; &quot;2012-06-07 09:03:00&quot; &quot;2013-03-29 10:08:00&quot; &quot;2013-06-25 14:51:00&quot; ...
##  $ sampleName       : chr [1:91103] &quot;84&quot; &quot;81&quot; &quot;84&quot; &quot;85&quot; ...
##  $ sampleNumber     : num [1:91103] 73 70 73 74 70 71 73 79 80 71 ...
##  $ river            : chr [1:91103] &quot;wb obear&quot; &quot;west brook&quot; &quot;west brook&quot; &quot;west brook&quot; ...
##  $ section          : chr [1:91103] &quot;7&quot; &quot;1&quot; &quot;40&quot; &quot;44&quot; ...
##  $ area             : chr [1:91103] &quot;trib&quot; &quot;inside&quot; &quot;inside&quot; &quot;inside&quot; ...
##  $ observedLength   : num [1:91103] 62 62 109 154 113 120 147 70 74 86 ...
##  $ survey           : chr [1:91103] &quot;shock&quot; &quot;shock&quot; &quot;shock&quot; &quot;shock&quot; ...
##  $ pass             : num [1:91103] 1 1 1 1 1 1 1 1 1 1 ...
##  $ observedWeight   : num [1:91103] 1.9 2.7 12.6 41.3 15.5 18.3 30.4 3.5 4.8 6.7 ...
##  $ comments         : chr [1:91103] &quot;additional genetic sample&quot; NA NA NA ...
##  $ cohort           : num [1:91103] 2012 2012 2012 2012 2011 ...
##  $ species          : chr [1:91103] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ...
##  $ dateEmigrated    : Date[1:91103], format: NA NA NA NA ...
##  $ sex              : chr [1:91103] NA NA NA NA ...
##  $ year             : num [1:91103] 2013 2012 2013 2013 2012 ...
##  $ season           : num [1:91103] 1 2 1 2 2 3 1 3 4 3 ...
##  $ proportionSampled: num [1:91103] 1 1 1 1 1 1 1 1 1 1 ...
##  $ lagDetectionDate : POSIXct[1:91103], format: NA NA &quot;2013-06-25 14:51:00&quot; NA ...
##  $ meanTemperature  : num [1:91103] NaN NaN 10.7 NaN 16.5 ...
##  $ meanFlow         : num [1:91103] NaN NaN 0.5247 NaN 0.0338 ...</code></pre>
</div>
<div id="wrangle-data" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Wrangle data<a href="getData.html#wrangle-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section takes cdWB_electro0 and cleans it to create cdWB_electro.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="getData.html#cb9-1" aria-hidden="true" tabindex="-1"></a>reclean_cdWB_electro <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="getData.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(reclean_cdWB_electro){</span>
<span id="cb10-2"><a href="getData.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  drainage <span class="ot">&lt;-</span> <span class="st">&#39;west&#39;</span></span>
<span id="cb10-3"><a href="getData.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="getData.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># functions in getPrepareWBData library</span></span>
<span id="cb10-5"><a href="getData.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  cdWB_electro <span class="ot">&lt;-</span> cdWB_electro0 <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="getData.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cleanData</span>(drainage) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="getData.html#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mergeSites</span>(drainage) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="getData.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addNPasses</span>(drainage) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="getData.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">drainage =</span> drainage)</span>
<span id="cb10-10"><a href="getData.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="getData.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(cdWB_electro, <span class="at">file =</span> <span class="st">&#39;./data/cdWB_electro.RData&#39;</span>)</span>
<span id="cb10-12"><a href="getData.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-13"><a href="getData.html#cb10-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb10-14"><a href="getData.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/cdWB_electro.RData&#39;</span>)</span>
<span id="cb10-15"><a href="getData.html#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="explore-data" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Explore data<a href="getData.html#explore-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="getData.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cdWB_electro, <span class="fu">aes</span>(observedLength, observedWeight, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="getData.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="getData.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="getData.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="getData.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication</span>() <span class="sc">+</span></span>
<span id="cb11-6"><a href="getData.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> species)</span></code></pre></div>
<p><img src="westBrook-book_files/figure-html/lw-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="getData.html#cb12-1" aria-hidden="true" tabindex="-1"></a>lwReg <span class="ot">&lt;-</span> cdWB_electro <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="getData.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="getData.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reg =</span> <span class="fu">list</span>(<span class="fu">lm</span>(<span class="fu">log</span>(observedWeight) <span class="sc">~</span> <span class="fu">log</span>(observedLength), <span class="at">data =</span> data)))</span>
<span id="cb12-4"><a href="getData.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="getData.html#cb12-5" aria-hidden="true" tabindex="-1"></a>lwReg <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(reg))  </span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   species [3]
##   species term                estimate std.error statistic p.value
##   &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 ats     (Intercept)           -11.4    0.00942    -1210.       0
## 2 ats     log(observedLength)     3.00   0.00208     1442.       0
## 3 bkt     (Intercept)           -11.5    0.00621    -1859.       0
## 4 bkt     log(observedLength)     3.02   0.00140     2155.       0
## 5 bnt     (Intercept)           -11.5    0.00686    -1670.       0
## 6 bnt     log(observedLength)     3.01   0.00149     2023.       0</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="getData.html#cb14-1" aria-hidden="true" tabindex="-1"></a>lwReg <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(broom<span class="sc">::</span><span class="fu">glance</span>(reg))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 13
## # Groups:   species [3]
##   species r.squared adj.r.squared  sigma statistic p.value    df logLik     AIC     BIC deviance df.residual  nobs
##   &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1 ats         0.989         0.989 0.0945  2080611.       0     1 22663. -45319. -45295.     215.       24092 24094
## 2 bkt         0.991         0.991 0.112   4643341.       0     1 32555. -65105. -65079.     537.       42490 42492
## 3 bnt         0.996         0.996 0.0858  4092957.       0     1 18345. -36683. -36660.     130.       17694 17696</code></pre>

</div>
</div>
<div id="dataCMR" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Capture-recapture data<a href="getData.html#dataCMR" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="getData.html#cb16-1" aria-hidden="true" tabindex="-1"></a>getNew_encounterHistories <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb16-2"><a href="getData.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="getData.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># maximum ageInSamples for both createCmrData and getEH</span></span>
<span id="cb16-4"><a href="getData.html#cb16-4" aria-hidden="true" tabindex="-1"></a>maxAgeInSamples <span class="ot">&lt;-</span> <span class="dv">12</span></span></code></pre></div>
<div id="temporary-home-for-updated-functions" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Temporary home for updated functions<a href="getData.html#temporary-home-for-updated-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="getData.html#cb17-1" aria-hidden="true" tabindex="-1"></a>addEnvironmental <span class="ot">&lt;-</span> <span class="cf">function</span>(coreData, <span class="at">sampleFlow =</span> F, <span class="at">funName =</span> <span class="st">&quot;mean&quot;</span>) {</span>
<span id="cb17-2"><a href="getData.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  func <span class="ot">&lt;-</span> <span class="fu">get</span>(funName)</span>
<span id="cb17-3"><a href="getData.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  whichDrainage <span class="ot">&lt;-</span> <span class="st">&quot;west&quot;</span></span>
<span id="cb17-4"><a href="getData.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="sc">!</span><span class="fu">unique</span>(coreData<span class="sc">$</span>river) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;west brook&quot;</span>, <span class="st">&quot;wb jimmy&quot;</span>, </span>
<span id="cb17-5"><a href="getData.html#cb17-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;wb mitchell&quot;</span>, <span class="st">&quot;wb obear&quot;</span>))) {</span>
<span id="cb17-6"><a href="getData.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    whichDrainage <span class="ot">&lt;-</span> <span class="st">&quot;stanley&quot;</span></span>
<span id="cb17-7"><a href="getData.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-8"><a href="getData.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (whichDrainage <span class="sc">==</span> <span class="st">&quot;west&quot;</span>) {</span>
<span id="cb17-9"><a href="getData.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    envData <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conDplyr, <span class="st">&quot;data_daily_temperature&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="getData.html#cb17-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">collect</span>(<span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="getData.html#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">full_join</span>(<span class="fu">tbl</span>(conDplyr, <span class="st">&quot;data_flow_extension&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="getData.html#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">collect</span>(<span class="at">n =</span> <span class="cn">Inf</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;river&quot;</span>, <span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="getData.html#cb17-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="getData.html#cb17-14" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">&lt;=</span> <span class="fu">max</span>(coreData<span class="sc">$</span>detectionDate), </span>
<span id="cb17-15"><a href="getData.html#cb17-15" aria-hidden="true" tabindex="-1"></a>                    date <span class="sc">&gt;=</span> <span class="fu">min</span>(coreData<span class="sc">$</span>detectionDate)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-16"><a href="getData.html#cb17-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">temperature =</span> daily_mean_temp, <span class="at">flow =</span> qPredicted) <span class="sc">%&gt;%</span> </span>
<span id="cb17-17"><a href="getData.html#cb17-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>()</span>
<span id="cb17-18"><a href="getData.html#cb17-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-19"><a href="getData.html#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb17-20"><a href="getData.html#cb17-20" aria-hidden="true" tabindex="-1"></a>    envData <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conDplyr, <span class="st">&quot;stanley_environmental&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-21"><a href="getData.html#cb17-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(section <span class="sc">==</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-22"><a href="getData.html#cb17-22" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(datetime, temperature, depth) <span class="sc">%&gt;%</span> </span>
<span id="cb17-23"><a href="getData.html#cb17-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">collect</span>(<span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-24"><a href="getData.html#cb17-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">flow =</span> depth, <span class="at">date =</span> datetime) <span class="sc">%&gt;%</span> </span>
<span id="cb17-25"><a href="getData.html#cb17-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>()</span>
<span id="cb17-26"><a href="getData.html#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Depth was inserted into flow column because that is what is available in Stanley&quot;</span>)</span>
<span id="cb17-27"><a href="getData.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-28"><a href="getData.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-29"><a href="getData.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  coreData <span class="ot">&lt;-</span> coreData <span class="sc">%&gt;%</span> </span>
<span id="cb17-30"><a href="getData.html#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(tag) <span class="sc">%&gt;%</span> </span>
<span id="cb17-31"><a href="getData.html#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(ageInSamples) <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="getData.html#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lagDetectionDate =</span> <span class="fu">lead</span>(detectionDate)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-33"><a href="getData.html#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb17-34"><a href="getData.html#cb17-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-35"><a href="getData.html#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (whichDrainage <span class="sc">==</span> <span class="st">&quot;west&quot;</span>) {</span>
<span id="cb17-36"><a href="getData.html#cb17-36" aria-hidden="true" tabindex="-1"></a>    getIntervalMean <span class="ot">&lt;-</span> <span class="cf">function</span>(start, end, r, e, <span class="at">fun =</span> func) {</span>
<span id="cb17-37"><a href="getData.html#cb17-37" aria-hidden="true" tabindex="-1"></a>      d <span class="ot">&lt;-</span> envData<span class="sc">$</span>date</span>
<span id="cb17-38"><a href="getData.html#cb17-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (e <span class="sc">==</span> <span class="st">&quot;Temperature&quot;</span>) {</span>
<span id="cb17-39"><a href="getData.html#cb17-39" aria-hidden="true" tabindex="-1"></a>        envCol <span class="ot">&lt;-</span> <span class="st">&quot;temperature&quot;</span></span>
<span id="cb17-40"><a href="getData.html#cb17-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(r)) </span>
<span id="cb17-41"><a href="getData.html#cb17-41" aria-hidden="true" tabindex="-1"></a>          meanVar <span class="ot">&lt;-</span> <span class="fu">fun</span>(envData[d <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> d <span class="sc">&lt;=</span> end, envCol], <span class="at">na.rm =</span> T)</span>
<span id="cb17-42"><a href="getData.html#cb17-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(r)) </span>
<span id="cb17-43"><a href="getData.html#cb17-43" aria-hidden="true" tabindex="-1"></a>          meanVar <span class="ot">&lt;-</span> <span class="fu">fun</span>(envData[d <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> d <span class="sc">&lt;=</span> end <span class="sc">&amp;</span> envData<span class="sc">$</span>river <span class="sc">==</span> r, envCol], <span class="at">na.rm =</span> T)</span>
<span id="cb17-44"><a href="getData.html#cb17-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-45"><a href="getData.html#cb17-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># will need to make this river-specific</span></span>
<span id="cb17-46"><a href="getData.html#cb17-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (e <span class="sc">==</span> <span class="st">&quot;Flow&quot;</span>) {</span>
<span id="cb17-47"><a href="getData.html#cb17-47" aria-hidden="true" tabindex="-1"></a>        envCol <span class="ot">&lt;-</span> <span class="st">&quot;flow&quot;</span></span>
<span id="cb17-48"><a href="getData.html#cb17-48" aria-hidden="true" tabindex="-1"></a>        meanVar <span class="ot">&lt;-</span> <span class="fu">fun</span>(envData[d <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> d <span class="sc">&lt;=</span> end, envCol], <span class="at">na.rm =</span> T)</span>
<span id="cb17-49"><a href="getData.html#cb17-49" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-50"><a href="getData.html#cb17-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(meanVar)</span>
<span id="cb17-51"><a href="getData.html#cb17-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-52"><a href="getData.html#cb17-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-53"><a href="getData.html#cb17-53" aria-hidden="true" tabindex="-1"></a>    coreDataUniqueDates <span class="ot">&lt;-</span> coreData <span class="sc">%&gt;%</span> </span>
<span id="cb17-54"><a href="getData.html#cb17-54" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(river, detectionDate, lagDetectionDate) <span class="sc">%&gt;%</span> </span>
<span id="cb17-55"><a href="getData.html#cb17-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-56"><a href="getData.html#cb17-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(river, detectionDate, lagDetectionDate) <span class="sc">%&gt;%</span> </span>
<span id="cb17-57"><a href="getData.html#cb17-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">meanTemperature =</span> <span class="fu">getIntervalMean</span>(detectionDate, lagDetectionDate, river, <span class="st">&quot;Temperature&quot;</span>), </span>
<span id="cb17-58"><a href="getData.html#cb17-58" aria-hidden="true" tabindex="-1"></a>             <span class="at">meanFlow =</span>        <span class="fu">getIntervalMean</span>(detectionDate, lagDetectionDate, river, <span class="st">&quot;Flow&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-59"><a href="getData.html#cb17-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>()</span>
<span id="cb17-60"><a href="getData.html#cb17-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-61"><a href="getData.html#cb17-61" aria-hidden="true" tabindex="-1"></a>    coreData <span class="ot">&lt;-</span> <span class="fu">left_join</span>(coreData, coreDataUniqueDates, </span>
<span id="cb17-62"><a href="getData.html#cb17-62" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;detectionDate&quot;</span>, <span class="st">&quot;river&quot;</span>, <span class="st">&quot;lagDetectionDate&quot;</span>))</span>
<span id="cb17-63"><a href="getData.html#cb17-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-64"><a href="getData.html#cb17-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb17-65"><a href="getData.html#cb17-65" aria-hidden="true" tabindex="-1"></a>    getIntervalMean <span class="ot">&lt;-</span> <span class="cf">function</span>(start, end, e, <span class="at">fun =</span> func) {</span>
<span id="cb17-66"><a href="getData.html#cb17-66" aria-hidden="true" tabindex="-1"></a>      d <span class="ot">&lt;-</span> envData<span class="sc">$</span>date</span>
<span id="cb17-67"><a href="getData.html#cb17-67" aria-hidden="true" tabindex="-1"></a>      meanEnv <span class="ot">&lt;-</span> <span class="fu">fun</span>(envData[d <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> d <span class="sc">&lt;=</span> end, <span class="fu">tolower</span>(e)], </span>
<span id="cb17-68"><a href="getData.html#cb17-68" aria-hidden="true" tabindex="-1"></a>                     <span class="at">na.rm =</span> T)</span>
<span id="cb17-69"><a href="getData.html#cb17-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(meanEnv)</span>
<span id="cb17-70"><a href="getData.html#cb17-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-71"><a href="getData.html#cb17-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-72"><a href="getData.html#cb17-72" aria-hidden="true" tabindex="-1"></a>    coreDataUniqueDates <span class="ot">&lt;-</span> coreData <span class="sc">%&gt;%</span> </span>
<span id="cb17-73"><a href="getData.html#cb17-73" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(detectionDate, lagDetectionDate) <span class="sc">%&gt;%</span> </span>
<span id="cb17-74"><a href="getData.html#cb17-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-75"><a href="getData.html#cb17-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(detectionDate, lagDetectionDate) <span class="sc">%&gt;%</span> </span>
<span id="cb17-76"><a href="getData.html#cb17-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">meanTemperature =</span> <span class="fu">getIntervalMean</span>(detectionDate, lagDetectionDate, <span class="st">&quot;Temperature&quot;</span>), </span>
<span id="cb17-77"><a href="getData.html#cb17-77" aria-hidden="true" tabindex="-1"></a>             <span class="at">meanFlow =</span> <span class="fu">getIntervalMean</span>(detectionDate, lagDetectionDate, <span class="st">&quot;Flow&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-78"><a href="getData.html#cb17-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>()</span>
<span id="cb17-79"><a href="getData.html#cb17-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-80"><a href="getData.html#cb17-80" aria-hidden="true" tabindex="-1"></a>    coreData <span class="ot">&lt;-</span> <span class="fu">left_join</span>(coreData, coreDataUniqueDates, </span>
<span id="cb17-81"><a href="getData.html#cb17-81" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;detectionDate&quot;</span>, <span class="st">&quot;lagDetectionDate&quot;</span>))</span>
<span id="cb17-82"><a href="getData.html#cb17-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-83"><a href="getData.html#cb17-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-84"><a href="getData.html#cb17-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sampleFlow) {</span>
<span id="cb17-85"><a href="getData.html#cb17-85" aria-hidden="true" tabindex="-1"></a>    coreData <span class="ot">&lt;-</span> coreData <span class="sc">%&gt;%</span> </span>
<span id="cb17-86"><a href="getData.html#cb17-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(detectionDate)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-87"><a href="getData.html#cb17-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(enc <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sampleName, date) <span class="sc">%&gt;%</span> </span>
<span id="cb17-88"><a href="getData.html#cb17-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(sampleName, date) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-89"><a href="getData.html#cb17-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-90"><a href="getData.html#cb17-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(envData <span class="sc">%&gt;%</span> </span>
<span id="cb17-91"><a href="getData.html#cb17-91" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(flow)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-92"><a href="getData.html#cb17-92" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-93"><a href="getData.html#cb17-93" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(date, flow) <span class="sc">%&gt;%</span> </span>
<span id="cb17-94"><a href="getData.html#cb17-94" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rename</span>(<span class="at">flowForP =</span> flow) <span class="sc">%&gt;%</span> </span>
<span id="cb17-95"><a href="getData.html#cb17-95" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">unique</span>(), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-96"><a href="getData.html#cb17-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(sampleName) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">flowForP =</span> <span class="fu">sum</span>(flowForP <span class="sc">*</span> n)<span class="sc">/</span>(<span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb17-97"><a href="getData.html#cb17-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-98"><a href="getData.html#cb17-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(coreData, <span class="at">by =</span> <span class="st">&quot;sampleName&quot;</span>)</span>
<span id="cb17-99"><a href="getData.html#cb17-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-100"><a href="getData.html#cb17-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(coreData)[<span class="fu">which</span>(<span class="fu">names</span>(coreData) <span class="sc">==</span> <span class="st">&quot;meanTemperature&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funName, <span class="st">&quot;Temperature&quot;</span>)</span>
<span id="cb17-101"><a href="getData.html#cb17-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(coreData)[<span class="fu">which</span>(<span class="fu">names</span>(coreData) <span class="sc">==</span> <span class="st">&quot;meanFlow&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funName,  <span class="st">&quot;Flow&quot;</span>)</span>
<span id="cb17-102"><a href="getData.html#cb17-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(coreData)</span>
<span id="cb17-103"><a href="getData.html#cb17-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-104"><a href="getData.html#cb17-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-105"><a href="getData.html#cb17-105" aria-hidden="true" tabindex="-1"></a>getKnown <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb17-106"><a href="getData.html#cb17-106" aria-hidden="true" tabindex="-1"></a>  firstObs <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(x <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb17-107"><a href="getData.html#cb17-107" aria-hidden="true" tabindex="-1"></a>  lastObs <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">which</span>(x <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb17-108"><a href="getData.html#cb17-108" aria-hidden="true" tabindex="-1"></a>  known <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(x))</span>
<span id="cb17-109"><a href="getData.html#cb17-109" aria-hidden="true" tabindex="-1"></a>  known[firstObs<span class="sc">:</span>lastObs] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-110"><a href="getData.html#cb17-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastObs <span class="sc">!=</span> <span class="fu">length</span>(known)) {</span>
<span id="cb17-111"><a href="getData.html#cb17-111" aria-hidden="true" tabindex="-1"></a>    known[(lastObs <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(known)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb17-112"><a href="getData.html#cb17-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-113"><a href="getData.html#cb17-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(known)</span>
<span id="cb17-114"><a href="getData.html#cb17-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-115"><a href="getData.html#cb17-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-116"><a href="getData.html#cb17-116" aria-hidden="true" tabindex="-1"></a>addKnownZ2 <span class="ot">&lt;-</span> <span class="cf">function</span>(d) {</span>
<span id="cb17-117"><a href="getData.html#cb17-117" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb17-118"><a href="getData.html#cb17-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(tag) <span class="sc">%&gt;%</span></span>
<span id="cb17-119"><a href="getData.html#cb17-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(sampleNumber) <span class="sc">%&gt;%</span></span>
<span id="cb17-120"><a href="getData.html#cb17-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">knownZ =</span> <span class="fu">getKnown</span>(enc)) <span class="sc">%&gt;%</span></span>
<span id="cb17-121"><a href="getData.html#cb17-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-122"><a href="getData.html#cb17-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(tag, sampleNumber)</span>
<span id="cb17-123"><a href="getData.html#cb17-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-124"><a href="getData.html#cb17-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-125"><a href="getData.html#cb17-125" aria-hidden="true" tabindex="-1"></a>addFirstLast <span class="ot">&lt;-</span> <span class="cf">function</span>(d){</span>
<span id="cb17-126"><a href="getData.html#cb17-126" aria-hidden="true" tabindex="-1"></a>  firstLast <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb17-127"><a href="getData.html#cb17-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(tag) <span class="sc">%&gt;%</span></span>
<span id="cb17-128"><a href="getData.html#cb17-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(knownZ <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-129"><a href="getData.html#cb17-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">firstObserved =</span> <span class="fu">min</span>(sampleNumber, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-130"><a href="getData.html#cb17-130" aria-hidden="true" tabindex="-1"></a>              <span class="at">lastObserved =</span> <span class="fu">max</span>(sampleNumber, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-131"><a href="getData.html#cb17-131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb17-132"><a href="getData.html#cb17-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-133"><a href="getData.html#cb17-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(d, firstLast) <span class="sc">%&gt;%</span></span>
<span id="cb17-134"><a href="getData.html#cb17-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">isFirstObserved =</span> sampleNumber <span class="sc">==</span> firstObserved,</span>
<span id="cb17-135"><a href="getData.html#cb17-135" aria-hidden="true" tabindex="-1"></a>           <span class="at">isLastObserved =</span> sampleNumber <span class="sc">==</span> lastObserved)</span>
<span id="cb17-136"><a href="getData.html#cb17-136" aria-hidden="true" tabindex="-1"></a>}    </span>
<span id="cb17-137"><a href="getData.html#cb17-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-138"><a href="getData.html#cb17-138" aria-hidden="true" tabindex="-1"></a>fillRiver <span class="ot">&lt;-</span> <span class="cf">function</span> (data, <span class="at">location =</span> T){</span>
<span id="cb17-139"><a href="getData.html#cb17-139" aria-hidden="true" tabindex="-1"></a>  fillLocation <span class="ot">&lt;-</span> <span class="cf">function</span>(location) {</span>
<span id="cb17-140"><a href="getData.html#cb17-140" aria-hidden="true" tabindex="-1"></a>    known <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(location))</span>
<span id="cb17-141"><a href="getData.html#cb17-141" aria-hidden="true" tabindex="-1"></a>    unknown <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(location))</span>
<span id="cb17-142"><a href="getData.html#cb17-142" aria-hidden="true" tabindex="-1"></a>    nKnown <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(location[known]))</span>
<span id="cb17-143"><a href="getData.html#cb17-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nKnown <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb17-144"><a href="getData.html#cb17-144" aria-hidden="true" tabindex="-1"></a>      location[unknown] <span class="ot">&lt;-</span> location[known[<span class="dv">1</span>]]</span>
<span id="cb17-145"><a href="getData.html#cb17-145" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-146"><a href="getData.html#cb17-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb17-147"><a href="getData.html#cb17-147" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> unknown) {</span>
<span id="cb17-148"><a href="getData.html#cb17-148" aria-hidden="true" tabindex="-1"></a>        location[i] <span class="ot">&lt;-</span> location[known[<span class="fu">max</span>(<span class="fu">which</span>(i <span class="sc">&gt;</span> known))]]</span>
<span id="cb17-149"><a href="getData.html#cb17-149" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-150"><a href="getData.html#cb17-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-151"><a href="getData.html#cb17-151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(location)</span>
<span id="cb17-152"><a href="getData.html#cb17-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-153"><a href="getData.html#cb17-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (location) {</span>
<span id="cb17-154"><a href="getData.html#cb17-154" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb17-155"><a href="getData.html#cb17-155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(tag) <span class="sc">%&gt;%</span> </span>
<span id="cb17-156"><a href="getData.html#cb17-156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">river =</span> <span class="fu">fillLocation</span>(river)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-157"><a href="getData.html#cb17-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>()</span>
<span id="cb17-158"><a href="getData.html#cb17-158" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-159"><a href="getData.html#cb17-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-160"><a href="getData.html#cb17-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb17-161"><a href="getData.html#cb17-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-162"><a href="getData.html#cb17-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-163"><a href="getData.html#cb17-163" aria-hidden="true" tabindex="-1"></a>scale_this <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb17-164"><a href="getData.html#cb17-164" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-165"><a href="getData.html#cb17-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-166"><a href="getData.html#cb17-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-167"><a href="getData.html#cb17-167" aria-hidden="true" tabindex="-1"></a>scaleEnvData <span class="ot">&lt;-</span> <span class="cf">function</span>(d){</span>
<span id="cb17-168"><a href="getData.html#cb17-168" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb17-169"><a href="getData.html#cb17-169" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(river, season) <span class="sc">%&gt;%</span> </span>
<span id="cb17-170"><a href="getData.html#cb17-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">meanMeanFlow =</span> <span class="fu">mean</span>(meanFlow, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-171"><a href="getData.html#cb17-171" aria-hidden="true" tabindex="-1"></a>              <span class="at">sdMeanFlow =</span> <span class="fu">sd</span>(meanFlow, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-172"><a href="getData.html#cb17-172" aria-hidden="true" tabindex="-1"></a>              <span class="at">meanMeanTemperature =</span> <span class="fu">mean</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-173"><a href="getData.html#cb17-173" aria-hidden="true" tabindex="-1"></a>              <span class="at">sdMeanTemperature =</span> <span class="fu">sd</span>(meanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-174"><a href="getData.html#cb17-174" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-175"><a href="getData.html#cb17-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb17-176"><a href="getData.html#cb17-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-177"><a href="getData.html#cb17-177" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">left_join</span>(d, tmp) <span class="sc">%&gt;%</span></span>
<span id="cb17-178"><a href="getData.html#cb17-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-179"><a href="getData.html#cb17-179" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanFlowScaled =</span> (meanFlow <span class="sc">-</span> meanMeanFlow) <span class="sc">/</span> sdMeanFlow,</span>
<span id="cb17-180"><a href="getData.html#cb17-180" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanTemperatureScaled =</span> (meanTemperature <span class="sc">-</span> meanMeanTemperature) <span class="sc">/</span> sdMeanTemperature</span>
<span id="cb17-181"><a href="getData.html#cb17-181" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb17-182"><a href="getData.html#cb17-182" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-183"><a href="getData.html#cb17-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-184"><a href="getData.html#cb17-184" aria-hidden="true" tabindex="-1"></a>getNeverCaptured <span class="ot">&lt;-</span> <span class="cf">function</span>(d, maxOccasionValue){</span>
<span id="cb17-185"><a href="getData.html#cb17-185" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb17-186"><a href="getData.html#cb17-186" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(ageInSamples &gt; 0 &amp; ageInSamples &lt;= maxOccasionValue) %&gt;%</span></span>
<span id="cb17-187"><a href="getData.html#cb17-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ageInSamples <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>maxOccasionValue) <span class="sc">%&gt;%</span></span>
<span id="cb17-188"><a href="getData.html#cb17-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(tag) <span class="sc">%&gt;%</span></span>
<span id="cb17-189"><a href="getData.html#cb17-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">sumEnc =</span> <span class="fu">sum</span>(enc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-190"><a href="getData.html#cb17-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sumEnc <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-191"><a href="getData.html#cb17-191" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(tag)</span>
<span id="cb17-192"><a href="getData.html#cb17-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-193"><a href="getData.html#cb17-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-194"><a href="getData.html#cb17-194" aria-hidden="true" tabindex="-1"></a>addRiverTagged <span class="ot">&lt;-</span> <span class="cf">function</span>(d){</span>
<span id="cb17-195"><a href="getData.html#cb17-195" aria-hidden="true" tabindex="-1"></a>  d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb17-196"><a href="getData.html#cb17-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(isFirstObserved) <span class="sc">%&gt;%</span></span>
<span id="cb17-197"><a href="getData.html#cb17-197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">riverTagged =</span> river) <span class="sc">%&gt;%</span></span>
<span id="cb17-198"><a href="getData.html#cb17-198" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(tag, riverTagged)</span>
<span id="cb17-199"><a href="getData.html#cb17-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-200"><a href="getData.html#cb17-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">left_join</span>(d, d1))</span>
<span id="cb17-201"><a href="getData.html#cb17-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-202"><a href="getData.html#cb17-202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-203"><a href="getData.html#cb17-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-204"><a href="getData.html#cb17-204" aria-hidden="true" tabindex="-1"></a>addIsYOY <span class="ot">&lt;-</span> <span class="cf">function</span>(d){</span>
<span id="cb17-205"><a href="getData.html#cb17-205" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb17-206"><a href="getData.html#cb17-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">isYOY =</span> <span class="fu">ifelse</span>(ageInSamples <span class="sc">&lt;=</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb17-207"><a href="getData.html#cb17-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-208"><a href="getData.html#cb17-208" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-209"><a href="getData.html#cb17-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-210"><a href="getData.html#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%notin%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">Negate</span>(<span class="st">`</span><span class="at">%in%</span><span class="st">`</span>)</span></code></pre></div>
</div>
<div id="get-data-1" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Get data<a href="getData.html#get-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>West Brook electrofishing data formatted for Capture-Mark-Recapture analysis for tagged individuals</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="getData.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#source(&#39;./rForSourcing/envFunctions.R&#39;)</span></span>
<span id="cb18-2"><a href="getData.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="getData.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(getNew_cdWB_CMR0) {</span>
<span id="cb18-4"><a href="getData.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  cdWB_CMR0 <span class="ot">&lt;-</span> </span>
<span id="cb18-5"><a href="getData.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createCoreData</span>(</span>
<span id="cb18-6"><a href="getData.html#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sampleType =</span> <span class="st">&quot;electrofishing&quot;</span>, <span class="co">#&quot;stationaryAntenna&quot;,&quot;portableAntenna&quot;),</span></span>
<span id="cb18-7"><a href="getData.html#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">whichDrainage =</span> <span class="st">&quot;west&quot;</span>,</span>
<span id="cb18-8"><a href="getData.html#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">columnsToAdd =</span></span>
<span id="cb18-9"><a href="getData.html#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;sampleNumber&quot;</span>,</span>
<span id="cb18-10"><a href="getData.html#cb18-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;river&quot;</span>,</span>
<span id="cb18-11"><a href="getData.html#cb18-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;riverMeter&quot;</span>,</span>
<span id="cb18-12"><a href="getData.html#cb18-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;survey&quot;</span>,</span>
<span id="cb18-13"><a href="getData.html#cb18-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;pass&quot;</span>,</span>
<span id="cb18-14"><a href="getData.html#cb18-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;observedLength&#39;</span>,</span>
<span id="cb18-15"><a href="getData.html#cb18-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;observedWeight&#39;</span>)</span>
<span id="cb18-16"><a href="getData.html#cb18-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="getData.html#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTagProperties</span>(</span>
<span id="cb18-18"><a href="getData.html#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">columnsToAdd =</span> </span>
<span id="cb18-19"><a href="getData.html#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;cohort&quot;</span>,</span>
<span id="cb18-20"><a href="getData.html#cb18-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;species&quot;</span>,</span>
<span id="cb18-21"><a href="getData.html#cb18-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;dateEmigrated&quot;</span>,</span>
<span id="cb18-22"><a href="getData.html#cb18-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb18-23"><a href="getData.html#cb18-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;species&quot;</span>)</span>
<span id="cb18-24"><a href="getData.html#cb18-24" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb18-25"><a href="getData.html#cb18-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tag), </span>
<span id="cb18-26"><a href="getData.html#cb18-26" aria-hidden="true" tabindex="-1"></a>                  area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;trib&quot;</span>,<span class="st">&quot;inside&quot;</span>,<span class="st">&quot;below&quot;</span>,<span class="st">&quot;above&quot;</span>), </span>
<span id="cb18-27"><a href="getData.html#cb18-27" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(sampleNumber) </span>
<span id="cb18-28"><a href="getData.html#cb18-28" aria-hidden="true" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-29"><a href="getData.html#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createCmrData</span>(<span class="at">maxAgeInSamples =</span> maxAgeInSamples <span class="sc">+</span> <span class="dv">1</span>, <span class="co"># +1 so we get env data for the last interval</span></span>
<span id="cb18-30"><a href="getData.html#cb18-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">inside =</span> F, </span>
<span id="cb18-31"><a href="getData.html#cb18-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">censorDead =</span> F, </span>
<span id="cb18-32"><a href="getData.html#cb18-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">censorEmigrated =</span> F) <span class="sc">%&gt;%</span> <span class="co"># may want to change censorEmigrated = T to = F</span></span>
<span id="cb18-33"><a href="getData.html#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample 83 is the last tagging sample</span></span>
<span id="cb18-34"><a href="getData.html#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sampleNumber <span class="sc">&lt;=</span> <span class="dv">83</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-35"><a href="getData.html#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addSampleProperties</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-36"><a href="getData.html#cb18-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addEnvironmental</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-37"><a href="getData.html#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># these functions do not work for CMR data - they separate out shock and non-shock samples</span></span>
<span id="cb18-38"><a href="getData.html#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#addEnvironmentalDaily() %&gt;%</span></span>
<span id="cb18-39"><a href="getData.html#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#addEnvironmentalInterval() %&gt;%</span></span>
<span id="cb18-40"><a href="getData.html#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addKnownZ2</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-41"><a href="getData.html#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addFirstLast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-42"><a href="getData.html#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fillRiver</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-43"><a href="getData.html#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addRiverTagged</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-44"><a href="getData.html#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scaleEnvData</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-45"><a href="getData.html#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addIsYOY</span>()</span>
<span id="cb18-46"><a href="getData.html#cb18-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-47"><a href="getData.html#cb18-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(cdWB_CMR0, <span class="at">file =</span> <span class="st">&#39;./data/cdWB_CMR0.RData&#39;</span>)</span>
<span id="cb18-48"><a href="getData.html#cb18-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(cdWB_CMR0, file = &#39;./data/cdWB_CMR0.csv&#39;)</span></span>
<span id="cb18-49"><a href="getData.html#cb18-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-50"><a href="getData.html#cb18-50" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-51"><a href="getData.html#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/cdWB_CMR0.RData&#39;</span>)</span>
<span id="cb18-52"><a href="getData.html#cb18-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-53"><a href="getData.html#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cdWB_CMR0)</span></code></pre></div>
<pre><code>## tibble [321,788 × 38] (S3: tbl_df/tbl/data.frame)
##  $ cohort               : num [1:321788] 2012 2012 2012 2012 2012 ...
##  $ tag                  : chr [1:321788] &quot;00088cbed0&quot; &quot;00088cbed0&quot; &quot;00088cbed0&quot; &quot;00088cbed0&quot; ...
##  $ detectionDate        : POSIXct[1:321788], format: &quot;2013-03-25 00:00:00&quot; &quot;2013-06-05 00:00:00&quot; &quot;2013-09-18 00:00:00&quot; &quot;2013-11-19 00:00:00&quot; ...
##  $ sampleName           : chr [1:321788] &quot;84&quot; &quot;85&quot; &quot;86&quot; &quot;87&quot; ...
##  $ sampleNumber         : num [1:321788] 73 74 75 76 77 78 79 80 81 82 ...
##  $ river                : chr [1:321788] &quot;wb obear&quot; &quot;wb obear&quot; &quot;wb obear&quot; &quot;wb obear&quot; ...
##  $ section              : chr [1:321788] &quot;7&quot; NA NA NA ...
##  $ area                 : chr [1:321788] &quot;trib&quot; NA NA NA ...
##  $ observedLength       : num [1:321788] 62 NA NA NA NA NA NA NA NA NA ...
##  $ survey               : chr [1:321788] &quot;shock&quot; NA NA NA ...
##  $ pass                 : num [1:321788] 1 NA NA NA NA NA NA NA NA NA ...
##  $ observedWeight       : num [1:321788] 1.9 NA NA NA NA NA NA NA NA NA ...
##  $ species              : chr [1:321788] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ...
##  $ dateEmigrated        : Date[1:321788], format: NA NA NA NA ...
##  $ sex                  : chr [1:321788] NA NA NA NA ...
##  $ enc                  : num [1:321788] 1 0 0 0 0 0 0 0 0 0 ...
##  $ ageInSamples         : num [1:321788] 3 4 5 6 7 8 9 10 11 12 ...
##  $ sampleIndex          : num [1:321788] 63 64 65 66 67 68 69 70 71 72 ...
##  $ tagIndex             : num [1:321788] 1 1 1 1 1 1 1 1 1 1 ...
##  $ year                 : num [1:321788] 2013 2013 2013 2013 2014 ...
##  $ season               : num [1:321788] 1 2 3 4 1 2 3 4 1 2 ...
##  $ proportionSampled    : num [1:321788] 1 NA NA NA NA NA NA NA NA NA ...
##  $ lagDetectionDate     : POSIXct[1:321788], format: &quot;2013-06-05 00:00:00&quot; &quot;2013-09-18 00:00:00&quot; &quot;2013-11-19 00:00:00&quot; &quot;2014-04-04 00:00:00&quot; ...
##  $ meanTemperature      : num [1:321788] 8.62 16.51 9.44 0.94 10.52 ...
##  $ meanFlow             : num [1:321788] 0.38874 0.30331 0.00882 0.31319 0.58363 ...
##  $ knownZ               : num [1:321788] 1 NA NA NA NA NA NA NA NA NA ...
##  $ firstObserved        : num [1:321788] 73 73 73 73 73 73 73 73 73 73 ...
##  $ lastObserved         : num [1:321788] 73 73 73 73 73 73 73 73 73 73 ...
##  $ isFirstObserved      : logi [1:321788] TRUE FALSE FALSE FALSE FALSE FALSE ...
##  $ isLastObserved       : logi [1:321788] TRUE FALSE FALSE FALSE FALSE FALSE ...
##  $ riverTagged          : chr [1:321788] &quot;wb obear&quot; &quot;wb obear&quot; &quot;wb obear&quot; &quot;wb obear&quot; ...
##  $ meanMeanFlow         : num [1:321788] 0.409 0.137 0.307 0.464 0.409 ...
##  $ sdMeanFlow           : num [1:321788] 0.155 0.126 0.246 0.113 0.155 ...
##  $ meanMeanTemperature  : num [1:321788] 10.39 16.23 8.42 1.65 10.39 ...
##  $ sdMeanTemperature    : num [1:321788] 1.202 0.711 1.455 0.616 1.202 ...
##  $ meanFlowScaled       : num [1:321788] -0.129 1.313 -1.215 -1.33 1.124 ...
##  $ meanTemperatureScaled: num [1:321788] -1.472 0.402 0.7 -1.149 0.105 ...
##  $ isYOY                : num [1:321788] 1 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
<div id="make-encounter-history-files" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Make encounter history files<a href="getData.html#make-encounter-history-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="getData.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/69583424/using-tidy-eval-for-multiple-arbitrary-filter-conditions</span></span>
<span id="cb20-2"><a href="getData.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes LHS is the name of a variable and OP is</span></span>
<span id="cb20-3"><a href="getData.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the name of a function</span></span>
<span id="cb20-4"><a href="getData.html#cb20-4" aria-hidden="true" tabindex="-1"></a>op_call <span class="ot">&lt;-</span> <span class="cf">function</span>(op, lhs, rhs) {</span>
<span id="cb20-5"><a href="getData.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">call</span>(op, <span class="fu">sym</span>(lhs), rhs)</span>
<span id="cb20-6"><a href="getData.html#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-7"><a href="getData.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="getData.html#cb20-8" aria-hidden="true" tabindex="-1"></a>ehFilter <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cols, ops, vals) {</span>
<span id="cb20-9"><a href="getData.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  exprs <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">pmap</span>(<span class="fu">list</span>(ops, cols, vals), op_call)</span>
<span id="cb20-10"><a href="getData.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!!!</span>exprs)</span>
<span id="cb20-11"><a href="getData.html#cb20-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="getData.html#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="getData.html#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="getData.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># var is the variable to put in the encounter history (e.g. &#39;enc&#39; or &#39;temp&#39;)</span></span>
<span id="cb20-15"><a href="getData.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># occasionVar is now fixed to ageInSamples</span></span>
<span id="cb20-16"><a href="getData.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># maxOccasionValue is the maximum value for occasion columns, in units of &#39;occasionVar&#39;</span></span>
<span id="cb20-17"><a href="getData.html#cb20-17" aria-hidden="true" tabindex="-1"></a>getEHDataWide_AIS <span class="ot">&lt;-</span> <span class="cf">function</span>(d, cols, ops, vals, var, maxOccasionValue, <span class="at">valuesFill =</span> <span class="dv">0</span>){   </span>
<span id="cb20-18"><a href="getData.html#cb20-18" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="getData.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ehFilter</span>(cols, ops, vals) <span class="sc">%&gt;%</span> </span>
<span id="cb20-20"><a href="getData.html#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(ageInSamples &gt; 0, ageInSamples &lt;= maxOccasionValue) %&gt;%</span></span>
<span id="cb20-21"><a href="getData.html#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(ageInSamples) <span class="sc">%&gt;%</span> <span class="co">#need this to get correct order of columns. </span></span>
<span id="cb20-22"><a href="getData.html#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb20-23"><a href="getData.html#cb20-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">id_cols =</span> tag,</span>
<span id="cb20-24"><a href="getData.html#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> ageInSamples,</span>
<span id="cb20-25"><a href="getData.html#cb20-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_prefix =</span> <span class="st">&quot;ais_&quot;</span>,</span>
<span id="cb20-26"><a href="getData.html#cb20-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> <span class="fu">eval</span>(<span class="fu">substitute</span>(var)),</span>
<span id="cb20-27"><a href="getData.html#cb20-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_fill =</span> valuesFill</span>
<span id="cb20-28"><a href="getData.html#cb20-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-29"><a href="getData.html#cb20-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-30"><a href="getData.html#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="getData.html#cb20-31" aria-hidden="true" tabindex="-1"></a>getEH_AIS <span class="ot">&lt;-</span> <span class="cf">function</span>(dIn, cols, ops, vals, maxOccasionValue, <span class="at">maxIndexByCohort =</span> <span class="fl">1E10</span>){</span>
<span id="cb20-32"><a href="getData.html#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="getData.html#cb20-33" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> dIn <span class="sc">%&gt;%</span> </span>
<span id="cb20-34"><a href="getData.html#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(ageInSamples &gt; 0, ageInSamples &lt;= maxOccasionValue)</span></span>
<span id="cb20-35"><a href="getData.html#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ageInSamples <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>maxOccasionValue)</span>
<span id="cb20-36"><a href="getData.html#cb20-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-37"><a href="getData.html#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fish with no observed occasions</span></span>
<span id="cb20-38"><a href="getData.html#cb20-38" aria-hidden="true" tabindex="-1"></a>  neverCaptured <span class="ot">&lt;-</span> <span class="fu">getNeverCaptured</span>(d, maxOccasionValue)</span>
<span id="cb20-39"><a href="getData.html#cb20-39" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb20-40"><a href="getData.html#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(tag <span class="sc">%notin%</span> neverCaptured<span class="sc">$</span>tag)</span>
<span id="cb20-41"><a href="getData.html#cb20-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-42"><a href="getData.html#cb20-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># limit data to first &#39;maxIndexByCohort&#39; individuals for each cohort</span></span>
<span id="cb20-43"><a href="getData.html#cb20-43" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb20-44"><a href="getData.html#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort) <span class="sc">%&gt;%</span></span>
<span id="cb20-45"><a href="getData.html#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">indexByCohort =</span> <span class="fu">rleid</span>(tag)) <span class="sc">%&gt;%</span></span>
<span id="cb20-46"><a href="getData.html#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(indexByCohort <span class="sc">&lt;=</span> maxIndexByCohort) <span class="sc">%&gt;%</span></span>
<span id="cb20-47"><a href="getData.html#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb20-48"><a href="getData.html#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="getData.html#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="getData.html#cb20-50" aria-hidden="true" tabindex="-1"></a>  encWide <span class="ot">&lt;-</span> <span class="fu">getEHDataWide_AIS</span>(d, cols, ops, vals, <span class="st">&quot;enc&quot;</span>, maxOccasionValue, <span class="at">valuesFill =</span> <span class="dv">0</span>)</span>
<span id="cb20-51"><a href="getData.html#cb20-51" aria-hidden="true" tabindex="-1"></a>  eh <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(encWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tag), <span class="at">nrow =</span> <span class="fu">nrow</span>(encWide), <span class="at">ncol =</span> <span class="fu">ncol</span>(encWide) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-52"><a href="getData.html#cb20-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-53"><a href="getData.html#cb20-53" aria-hidden="true" tabindex="-1"></a>  flowFill <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-54"><a href="getData.html#cb20-54" aria-hidden="true" tabindex="-1"></a>  flowWide <span class="ot">&lt;-</span> <span class="fu">getEHDataWide_AIS</span>(d, cols, ops, vals, <span class="st">&quot;meanFlowScaled&quot;</span>, maxOccasionValue, <span class="at">valuesFill =</span> flowFill)</span>
<span id="cb20-55"><a href="getData.html#cb20-55" aria-hidden="true" tabindex="-1"></a>  flowMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(flowWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tag), <span class="at">nrow =</span> <span class="fu">nrow</span>(flowWide), <span class="at">ncol =</span> <span class="fu">ncol</span>(flowWide) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-56"><a href="getData.html#cb20-56" aria-hidden="true" tabindex="-1"></a>  flowMatrix <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(flowMatrix), flowMatrix, flowFill)</span>
<span id="cb20-57"><a href="getData.html#cb20-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-58"><a href="getData.html#cb20-58" aria-hidden="true" tabindex="-1"></a>  temperatureFill <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-59"><a href="getData.html#cb20-59" aria-hidden="true" tabindex="-1"></a>  temperatureWide <span class="ot">&lt;-</span> <span class="fu">getEHDataWide_AIS</span>(d, cols, ops, vals, <span class="st">&quot;meanTemperatureScaled&quot;</span>, maxOccasionValue, <span class="at">valuesFill =</span> temperatureFill)</span>
<span id="cb20-60"><a href="getData.html#cb20-60" aria-hidden="true" tabindex="-1"></a>  temperatureMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(temperatureWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tag), <span class="at">nrow =</span> <span class="fu">nrow</span>(temperatureWide), <span class="at">ncol =</span> <span class="fu">ncol</span>(temperatureWide) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-61"><a href="getData.html#cb20-61" aria-hidden="true" tabindex="-1"></a>  temperatureMatrix <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(temperatureMatrix), temperatureMatrix, temperatureFill)</span>
<span id="cb20-62"><a href="getData.html#cb20-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-63"><a href="getData.html#cb20-63" aria-hidden="true" tabindex="-1"></a>  riverWide <span class="ot">&lt;-</span> <span class="fu">getEHDataWide_AIS</span>(d, cols, ops, vals, <span class="st">&quot;river&quot;</span>, maxOccasionValue, <span class="at">valuesFill =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb20-64"><a href="getData.html#cb20-64" aria-hidden="true" tabindex="-1"></a>  riverMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(riverWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tag), <span class="at">nrow =</span> <span class="fu">nrow</span>(riverWide), <span class="at">ncol =</span> <span class="fu">ncol</span>(riverWide) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-65"><a href="getData.html#cb20-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-66"><a href="getData.html#cb20-66" aria-hidden="true" tabindex="-1"></a>  isYOYWide <span class="ot">&lt;-</span> <span class="fu">getEHDataWide_AIS</span>(d, cols, ops, vals, <span class="st">&quot;isYOY&quot;</span>, maxOccasionValue, <span class="at">valuesFill =</span> <span class="dv">2</span>)</span>
<span id="cb20-67"><a href="getData.html#cb20-67" aria-hidden="true" tabindex="-1"></a>  isYOYMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(isYOYWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tag), <span class="at">nrow =</span> <span class="fu">nrow</span>(isYOYWide), <span class="at">ncol =</span> <span class="fu">ncol</span>(riverWide) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-68"><a href="getData.html#cb20-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-69"><a href="getData.html#cb20-69" aria-hidden="true" tabindex="-1"></a>  tags <span class="ot">&lt;-</span> encWide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tag)</span>
<span id="cb20-70"><a href="getData.html#cb20-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-71"><a href="getData.html#cb20-71" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb20-72"><a href="getData.html#cb20-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ehFilter</span>(cols, ops, vals) <span class="sc">%&gt;%</span> </span>
<span id="cb20-73"><a href="getData.html#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(ageInSamples &gt; 0, ageInSamples &lt;= maxOccasionValue) %&gt;%</span></span>
<span id="cb20-74"><a href="getData.html#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ageInSamples <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>maxOccasionValue) <span class="sc">%&gt;%</span></span>
<span id="cb20-75"><a href="getData.html#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(tag, ageInSamples)</span>
<span id="cb20-76"><a href="getData.html#cb20-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-77"><a href="getData.html#cb20-77" aria-hidden="true" tabindex="-1"></a>  cohorts <span class="ot">&lt;-</span> tags <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tag, cohort) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(cohort)</span>
<span id="cb20-78"><a href="getData.html#cb20-78" aria-hidden="true" tabindex="-1"></a>  seasons <span class="ot">&lt;-</span> tags <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(tag, season) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(season)</span>
<span id="cb20-79"><a href="getData.html#cb20-79" aria-hidden="true" tabindex="-1"></a>  first <span class="ot">&lt;-</span> <span class="fu">apply</span>(eh, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">min</span>(<span class="fu">which</span>(x <span class="sc">!=</span> <span class="dv">0</span>)))</span>
<span id="cb20-80"><a href="getData.html#cb20-80" aria-hidden="true" tabindex="-1"></a>  last <span class="ot">&lt;-</span> <span class="fu">apply</span>(riverMatrix, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">max</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(x))))</span>
<span id="cb20-81"><a href="getData.html#cb20-81" aria-hidden="true" tabindex="-1"></a>  last <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(last <span class="sc">==</span> maxOccasionValue, last, last <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-82"><a href="getData.html#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="getData.html#cb20-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">eh =</span> eh, <span class="at">flow =</span> flowMatrix, <span class="at">temperature =</span> temperatureMatrix, <span class="at">river =</span> riverMatrix,</span>
<span id="cb20-84"><a href="getData.html#cb20-84" aria-hidden="true" tabindex="-1"></a>              <span class="at">isYOY =</span> isYOYMatrix, <span class="at">tags =</span> tags, <span class="at">cohorts =</span> cohorts, <span class="at">seasons =</span> seasons, </span>
<span id="cb20-85"><a href="getData.html#cb20-85" aria-hidden="true" tabindex="-1"></a>              <span class="at">first =</span> first, <span class="at">last =</span> last, <span class="at">data =</span> data))</span>
<span id="cb20-86"><a href="getData.html#cb20-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-87"><a href="getData.html#cb20-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-88"><a href="getData.html#cb20-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-89"><a href="getData.html#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="co">#if (getNew_encounterHistories) {</span></span>
<span id="cb20-90"><a href="getData.html#cb20-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-91"><a href="getData.html#cb20-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read down through the cols, ops, vals variables for filter conditions</span></span>
<span id="cb20-92"><a href="getData.html#cb20-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-93"><a href="getData.html#cb20-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-94"><a href="getData.html#cb20-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># all cohorts 2002:2014</span></span>
<span id="cb20-95"><a href="getData.html#cb20-95" aria-hidden="true" tabindex="-1"></a>  cdWB_CMR0 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(river <span class="sc">==</span> <span class="st">&quot;wb obear&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cohort) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 17 × 2
##    cohort     n
##     &lt;dbl&gt; &lt;int&gt;
##  1   1999     2
##  2   2000   135
##  3   2001  1285
##  4   2002  2358
##  5   2003  3009
##  6   2004  1844
##  7   2005   791
##  8   2006  1443
##  9   2007  1058
## 10   2008   968
## 11   2009  5580
## 12   2010   499
## 13   2011   444
## 14   2012  6246
## 15   2013   729
## 16   2014   725
## 17   2015     5</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="getData.html#cb22-1" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;cohort&quot;</span>,  <span class="st">&quot;riverTagged&quot;</span>)</span>
<span id="cb22-2"><a href="getData.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  ops <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">&quot;%in%&quot;</span>,    <span class="st">&quot;==&quot;</span>)</span>
<span id="cb22-3"><a href="getData.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">2002</span><span class="sc">:</span><span class="dv">2014</span>, <span class="st">&quot;wb obear&quot;</span>)</span>
<span id="cb22-4"><a href="getData.html#cb22-4" aria-hidden="true" tabindex="-1"></a>                                                               <span class="co"># only include first x fish per cohort</span></span>
<span id="cb22-5"><a href="getData.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  eh <span class="ot">&lt;-</span> <span class="fu">getEH_AIS</span>(cdWB_CMR0, cols, ops, vals, maxAgeInSamples)<span class="co">#, maxIndexByCohort = 100)</span></span>
<span id="cb22-6"><a href="getData.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  fileName <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;eh_&quot;</span>, <span class="fu">stri_paste_list</span>(vals, <span class="at">collapse =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb22-7"><a href="getData.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(eh, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&#39;./models/cmrFlowWB/dataOut/&#39;</span>, fileName, <span class="st">&#39;.RData&#39;</span>))</span>
<span id="cb22-8"><a href="getData.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-9"><a href="getData.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output for Xioawei</span></span>
<span id="cb22-10"><a href="getData.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(eh)){</span>
<span id="cb22-11"><a href="getData.html#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.csv</span>(eh[[i]], <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&#39;./models/cmrFlowWB/dataOut/&#39;</span>, </span>
<span id="cb22-12"><a href="getData.html#cb22-12" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">names</span>(eh)[i], </span>
<span id="cb22-13"><a href="getData.html#cb22-13" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;.csv&quot;</span>), </span>
<span id="cb22-14"><a href="getData.html#cb22-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">row.names =</span> F)</span>
<span id="cb22-15"><a href="getData.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-16"><a href="getData.html#cb22-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-17"><a href="getData.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span></code></pre></div>
</div>
<div id="wrangle-data-1" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Wrangle data<a href="getData.html#wrangle-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="explore-data-1" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Explore data<a href="getData.html#explore-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="getData.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cdWB_CMR0 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(enc <span class="sc">==</span><span class="dv">1</span>), <span class="fu">aes</span>(year)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="getData.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="getData.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(river <span class="sc">+</span> season <span class="sc">~</span> species)</span></code></pre></div>
<p><img src="westBrook-book_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="cmr-metadata" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> CMR metadata<a href="getData.html#cmr-metadata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="adapted-from-httpsgithub.comconte-ecologywestbrookdatablobmastergetwbdatavignetteswestbrookdataintro.rmd" class="section level4 hasAnchor" number="2.3.6.1">
<h4><span class="header-section-number">2.3.6.1</span> adapted from <a href="https://github.com/Conte-Ecology/westBrookData/blob/master/getWBData/vignettes/westBrookDataIntro.Rmd" class="uri">https://github.com/Conte-Ecology/westBrookData/blob/master/getWBData/vignettes/westBrookDataIntro.Rmd</a><a href="getData.html#adapted-from-httpsgithub.comconte-ecologywestbrookdatablobmastergetwbdatavignetteswestbrookdataintro.rmd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="column-explanations" class="section level4 hasAnchor" number="2.3.6.2">
<h4><span class="header-section-number">2.3.6.2</span> Column explanations<a href="getData.html#column-explanations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>tag</strong> PIT tag number, unique identifier, character</p>
<p><strong>cohort</strong> year the fish was born, assigned based on size at initial capture and size distributions of fish of known age</p>
<p><strong>detectionDate</strong> mostly self explanatory, but filled in for unobserved fish as the median capture date for all observed fish.</p>
<p><strong>sampleName</strong> An ordered identifier for sampling mostly for recognition by people who did the sampling. This is not very clean because early in the study samples were not taken at strictly seasonal intervals. sampleNumber is probably more useful and intuitive.</p>
<p><strong>sampleNumber</strong> A tidier identifier for samples that strictly increases by one for each season (4/yr)</p>
<p><strong>river</strong> River the fish was observed in. NA if the fish was not observed.</p>
<p><strong>west brook</strong> The mainstem</p>
<p><strong>wb jimmy</strong> Larger tributary that fish can move back and forth into from WB section 31 (Open Large from Letcher et al 2015)</p>
<p><strong>wb mitchell</strong> Smaller tributary that fish can move back and forth into from WB section 35 (Open Small from Letcher et al 2015)</p>
<p><strong>wb obear</strong> Smaller tributary that has a waterfall at its mouth, so fish can only move downstream into WB section 20 (Isolated Small from Letcher et al 2015)</p>
<p><strong>section</strong> Identifier for the 20m section that the fish was captured in. This is ordered from downstream to upstream starting at 1 within each river.</p>
<p><strong>area</strong> inside = section 1:47 in the west brook, trib = tributary (not west brook), below = sections below inside sections, above = sections above the inside sections</p>
<p><strong>observedLength</strong> in mm</p>
<p><strong>survey</strong> shock = electroshocking survey</p>
<p><strong>pass</strong> electrofishing pass. 1 or 2 in the west brook (inside), 1 in tribs</p>
<p><strong>observedWeight</strong> in g wet weight</p>
<p><strong>species</strong><br />
bkt = brook trout (native, self-sustained population)<br />
bnt = brown trout (non-native, self-sustained population)<br />
ats = atlantic salmon (stocked through 2005, no reproduction)</p>
<p><strong>dateEmigrated</strong> date of emigration from inside/tribs if observed to emigrate. Coded as emigrated if last observation was on PIT antenna or captured below or above</p>
<p><strong>sex</strong> NA = unknown, f = female, m = male, p = precocious male (salmon only)</p>
<p><strong>enc</strong><br />
Logical, was the fish observed? (1 = yes, 0 = no)</p>
<p><strong>ageInSamples</strong> number of seasons since summer of the year of birth (1st summer = 0)</p>
<p><strong>sampleIndex</strong> sampleNumber rescaled to start at 1 and end at length(unique(sampleNumber)) for ease of looping in JAGS</p>
<p><strong>tagIndex</strong> ordered, unique individual identifier 1:N</p>
<p><strong>year</strong> of sample</p>
<p><strong>season</strong> 1 = spring, 2 = summer, 3 = fall, 4 = winter</p>
<p><strong>proportionSampled</strong> Occasionally the sample was not complete (e.g., skipped west brook but did the tributaries). This is the proportion of sections in the river of capture that were sampled.</p>
<p><strong>lagDetectionDate</strong> detection date lagged back one observation</p>
<p><strong>meanTemperature</strong> mean temperature between observation dates. If individual was not observed, median observation date for the sampling occasion was used.</p>
<p><strong>meanFlow</strong> mean flow between observation dates. If individual was not observed, median observation date for the sampling occasion was used.</p>
<p><strong>knownZ</strong> z is alive state, so this is ‘1’ between first and last capture, and NA otherwise, unless the fish was known to be dead (e.g. tagging mortality or observed dead) in which case the value is set to ‘2’. There is also an option in the addKnownZ() function to useAntenna. This is useAntenna = FALSE by default, but could be set to TRUE to set knownZ to 1 up to the last antenna observation.</p>

</div>
</div>
</div>
<div id="dataWanding" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Wanding data<a href="getData.html#dataWanding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="get-data-2" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Get data<a href="getData.html#get-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>West Brook wanding data</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="getData.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(getNew_cdWB_wanding0) {</span>
<span id="cb24-2"><a href="getData.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from wandingDataWB project in d:/ben/github/wandingData/</span></span>
<span id="cb24-3"><a href="getData.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  cdWB_wanding0 <span class="ot">&lt;-</span> <span class="fu">createCoreData</span>(</span>
<span id="cb24-4"><a href="getData.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampleType =</span> <span class="st">&quot;portableAntenna&quot;</span>,</span>
<span id="cb24-5"><a href="getData.html#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnsToAdd =</span> <span class="fu">c</span>(<span class="st">&quot;tag&quot;</span>, </span>
<span id="cb24-6"><a href="getData.html#cb24-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;detectionDate&quot;</span>, </span>
<span id="cb24-7"><a href="getData.html#cb24-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;river&quot;</span>, </span>
<span id="cb24-8"><a href="getData.html#cb24-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;area&quot;</span>, </span>
<span id="cb24-9"><a href="getData.html#cb24-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;section&quot;</span>, </span>
<span id="cb24-10"><a href="getData.html#cb24-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;survey&quot;</span>, </span>
<span id="cb24-11"><a href="getData.html#cb24-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;sampleName&quot;</span>, </span>
<span id="cb24-12"><a href="getData.html#cb24-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;readerId&quot;</span>, </span>
<span id="cb24-13"><a href="getData.html#cb24-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;aliveOrDead&quot;</span>, </span>
<span id="cb24-14"><a href="getData.html#cb24-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;instance&quot;</span>, </span>
<span id="cb24-15"><a href="getData.html#cb24-15" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;pass&quot;</span>, </span>
<span id="cb24-16"><a href="getData.html#cb24-16" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;quarter&quot;</span>, </span>
<span id="cb24-17"><a href="getData.html#cb24-17" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;leftOrRight&quot;</span>, </span>
<span id="cb24-18"><a href="getData.html#cb24-18" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;habitat&quot;</span>, </span>
<span id="cb24-19"><a href="getData.html#cb24-19" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;cover&quot;</span>, </span>
<span id="cb24-20"><a href="getData.html#cb24-20" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;justification&quot;</span>, </span>
<span id="cb24-21"><a href="getData.html#cb24-21" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;comment&quot;</span>)</span>
<span id="cb24-22"><a href="getData.html#cb24-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-23"><a href="getData.html#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTagProperties</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-24"><a href="getData.html#cb24-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>( species <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;bkt&quot;</span>,<span class="st">&quot;bnt&quot;</span>,<span class="st">&quot;ats&quot;</span> ) )</span>
<span id="cb24-25"><a href="getData.html#cb24-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-26"><a href="getData.html#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(cdWB_wanding0, <span class="at">file =</span> <span class="st">&#39;./data/cdWB_wanding0.RData&#39;</span>)</span>
<span id="cb24-27"><a href="getData.html#cb24-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-28"><a href="getData.html#cb24-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-29"><a href="getData.html#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/cdWB_wanding0.RData&#39;</span>)</span>
<span id="cb24-30"><a href="getData.html#cb24-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-31"><a href="getData.html#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cdWB_wanding0)</span></code></pre></div>
<pre><code>## tibble [14,880 × 19] (S3: tbl_df/tbl/data.frame)
##  $ tag          : chr [1:14880] &quot;00088cf41b&quot; &quot;00088cf41b&quot; &quot;00088cf41b&quot; &quot;00088cf435&quot; ...
##  $ detectionDate: POSIXct[1:14880], format: &quot;2010-09-27 11:08:45&quot; &quot;2010-10-18 14:16:22&quot; &quot;2010-10-25 11:40:24&quot; &quot;2010-12-06 13:32:15&quot; ...
##  $ sampleName   : chr [1:14880] &quot;92710.00&quot; &quot;101810.00&quot; &quot;102510.00&quot; &quot;12610.00&quot; ...
##  $ river        : chr [1:14880] &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; ...
##  $ section      : chr [1:14880] &quot;13&quot; &quot;14&quot; &quot;14&quot; &quot;2&quot; ...
##  $ area         : chr [1:14880] &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; ...
##  $ survey       : chr [1:14880] &quot;portableAntenna&quot; &quot;portableAntenna&quot; &quot;portableAntenna&quot; &quot;portableAntenna&quot; ...
##  $ readerId     : chr [1:14880] &quot;iso&quot; &quot;iso&quot; &quot;iso&quot; &quot;iso&quot; ...
##  $ aliveOrDead  : chr [1:14880] &quot;alive&quot; &quot;alive&quot; NA &quot;alive&quot; ...
##  $ instance     : num [1:14880] 1 2 3 1 1 1 2 1 1 1 ...
##  $ pass         : num [1:14880] NA NA NA NA NA NA NA NA NA NA ...
##  $ quarter      : num [1:14880] 2 1 NA 4 2 4 4 3 4 2 ...
##  $ leftOrRight  : chr [1:14880] &quot;l&quot; &quot;m&quot; NA &quot;r&quot; ...
##  $ habitat      : chr [1:14880] &quot;pool&quot; &quot;run&quot; NA &quot;pool&quot; ...
##  $ cover        : chr [1:14880] NA NA NA NA ...
##  $ justification: chr [1:14880] NA NA NA NA ...
##  $ comment      : chr [1:14880] NA NA NA NA ...
##  $ species      : chr [1:14880] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ...
##  $ cohort       : num [1:14880] 2010 2010 2010 2010 2009 ...</code></pre>
</div>
<div id="wrangle-data-2" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Wrangle data<a href="getData.html#wrangle-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="explore-data-2" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Explore data<a href="getData.html#explore-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
<div id="dataAntenna" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Antenna data<a href="getData.html#dataAntenna" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="get-data-3" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Get data<a href="getData.html#get-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>West Brook antenna data
Note: some pitAntenna code at <a href="https://github.com/bletcher/pitAntenna/blob/master/WB/getAndPrepareDataWB.R" class="uri">https://github.com/bletcher/pitAntenna/blob/master/WB/getAndPrepareDataWB.R</a></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="getData.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(getNew_cdWB_antenna0) {</span>
<span id="cb26-2"><a href="getData.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  cdWB_antenna0 <span class="ot">&lt;-</span> <span class="fu">createCoreData</span>(</span>
<span id="cb26-3"><a href="getData.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampleType=</span><span class="fu">c</span>(<span class="st">&quot;stationaryAntenna&quot;</span>), </span>
<span id="cb26-4"><a href="getData.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">whichDrainage =</span> <span class="st">&quot;west&quot;</span>,</span>
<span id="cb26-5"><a href="getData.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnsToAdd=</span><span class="fu">c</span>(</span>
<span id="cb26-6"><a href="getData.html#cb26-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;river&quot;</span>,</span>
<span id="cb26-7"><a href="getData.html#cb26-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;riverMeter&quot;</span>,</span>
<span id="cb26-8"><a href="getData.html#cb26-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;survey&quot;</span>,</span>
<span id="cb26-9"><a href="getData.html#cb26-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;readerID&quot;</span>,</span>
<span id="cb26-10"><a href="getData.html#cb26-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;comment&quot;</span></span>
<span id="cb26-11"><a href="getData.html#cb26-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb26-12"><a href="getData.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb26-13"><a href="getData.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tag)) <span class="sc">%&gt;%</span> <span class="co"># for now</span></span>
<span id="cb26-14"><a href="getData.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTagProperties</span>(<span class="at">columnsToAdd =</span> <span class="fu">c</span>(</span>
<span id="cb26-15"><a href="getData.html#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;cohort&quot;</span>,</span>
<span id="cb26-16"><a href="getData.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;species&quot;</span>,</span>
<span id="cb26-17"><a href="getData.html#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dateEmigrated&quot;</span>,</span>
<span id="cb26-18"><a href="getData.html#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb26-19"><a href="getData.html#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;species&quot;</span>)</span>
<span id="cb26-20"><a href="getData.html#cb26-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-21"><a href="getData.html#cb26-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-22"><a href="getData.html#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(cdWB_antenna0, <span class="at">file =</span> <span class="st">&#39;./data/cdWB_antenna0.RData&#39;</span>)</span>
<span id="cb26-23"><a href="getData.html#cb26-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-24"><a href="getData.html#cb26-24" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-25"><a href="getData.html#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">&#39;./data/cdWB_antenna0.RData&#39;</span>)</span>
<span id="cb26-26"><a href="getData.html#cb26-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-27"><a href="getData.html#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="getData.html#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cdWB_antenna0)</span></code></pre></div>
<pre><code>## tibble [410,915 × 10] (S3: tbl_df/tbl/data.frame)
##  $ tag          : chr [1:410915] &quot;00088cbed9&quot; &quot;00088cbed9&quot; &quot;00088cbed9&quot; &quot;00088cbed9&quot; ...
##  $ detectionDate: POSIXct[1:410915], format: &quot;2014-10-17 20:22:33&quot; &quot;2014-10-24 15:34:31&quot; &quot;2014-10-24 16:03:51&quot; &quot;2014-10-24 17:29:37&quot; ...
##  $ river        : chr [1:410915] &quot;wb mitchell&quot; &quot;wb mitchell&quot; &quot;wb mitchell&quot; &quot;wb mitchell&quot; ...
##  $ riverMeter   : num [1:410915] 4797 4797 4830 4830 5524 ...
##  $ survey       : chr [1:410915] &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; ...
##  $ comment      : chr [1:410915] NA NA NA NA ...
##  $ cohort       : num [1:410915] 2013 2013 2013 2013 2013 ...
##  $ species      : chr [1:410915] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ...
##  $ dateEmigrated: Date[1:410915], format: &quot;2014-10-25&quot; &quot;2014-10-25&quot; &quot;2014-10-25&quot; &quot;2014-10-25&quot; ...
##  $ sex          : chr [1:410915] NA NA NA NA ...</code></pre>
</div>
<div id="wrangle-data-3" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Wrangle data<a href="getData.html#wrangle-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="explore-data-3" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Explore data<a href="getData.html#explore-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["westBrook-book.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
